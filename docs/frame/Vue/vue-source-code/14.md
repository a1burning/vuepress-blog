---
title: 虚拟DOM
tags: 
  - Vue
prev: ./13.md
next: false
sidebarDepth: 5
---

## 知识链接

- [虚拟DOM库 —— Snabbdom](../virtual-dom/02.md)
- [响应式原理模拟实现](../vue-observe/01.md)

## 概念

虚拟 DOM(Virtual DOM) 是使用 JavaScript 对象来描述 DOM，虚拟 DOM 的本质就是 JavaScript 对象，使用 JavaScript 对象来描述 DOM 的结构。应用的各种状态变化首先作用于虚拟 DOM，最终映射到 DOM。Vue的MVVM框架会帮我们屏蔽DOM操作

Vue.js 中的虚拟 DOM 借鉴了Snabbdom(模块机制，钩子函数，diff算法)，并添加了一些 Vue.js 中的特性，例如：指令和组件机制。

Vue 1.x 中细粒度监测数据的变化，每一个属性对应一个watcher，开销太大Vue 2.x 中每个组件对应一个 watcher，状态变化通知到组件，再引入虚拟 DOM 进行比对和渲染

## 为什么要使用虚拟 DOM ?

- 使用虚拟 DOM，可以避免用户直接操作DOM，开发过程关注在业务代码的实现，不需要关注如何操作 DOM，从而提高开发效率
- 作为一个中间层可以跨平台，除了 Web 平台外，还支持 SSR服务端渲染、Weex框架。
- 关于性能方面
    + 在首次渲染的时候肯定不如直接操作DOM，因为要维护一层额外的虚拟 DOM
    + 如果后续有频繁操作DOM的操作，这个时候可能会有性能的提升，虚拟DOM在更新真实DOM之前会通过Diff算法对比新旧两个虚拟DOM树的差异，最终把差异更新到真实 DOM
    + 添加key属性，会让DOM尽可能重用，比不加key的性能要优化的多

## 代码演示虚拟DOM
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Vue.js 01 component example</title>
  </head>
  <body>
    <div id="app">
    </div>

    <script src="../../dist/vue.runtime.js"></script>
    <script>
      const vm = new Vue({
        el: '#app',
        render (h) { 
          // return h('h1', this.msg) 
          // h1 DOM对象的属性
          // return h('h1', { domProps: { innerHTML: this.msg } }) 
          // attrs:标签属性
          // return h('h1', { attrs: { id: 'title' } }, this.msg) 
          const vnode = h(
            'h1',
            {
              attrs: { id: 'title' }
            },
            this.msg 
          )
          // 返回结果是一个VNode对象
          console.log(vnode) 
          return vnode
        },
        data: {
          msg: 'Hello Vue'
        }
      })
    </script>
  </body>
</html>
```

打开浏览器可以看到返回的虚拟DOM

![image](~@public/assets/images/vue/vue-source-code/vue-vnode.png)